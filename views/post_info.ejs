<!DOCTYPE html>
<html>
<head>
    <title>Signup</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script defer>
        document.addEventListener("DOMContentLoaded", () => {
            const likeButton = document.querySelector(".likeButton");
            likeButton.addEventListener("click", async () => {
                const response = await fetch(likeButton.dataset.url, { method: "POST" });
                const responseData = await response.json();
                const likes = document.querySelector(".likes");
                likes.textContent = responseData.postLikes;
                likeButton.textContent = responseData.buttonToggle;
            });
        });
    </script>
</head>
<body>
    <% if (post.user === user) { %>
        <a href="<%= post.url %>/update">Update Post</a>
        <a href="<%= post.url %>/delete">Delete Post</a>
    <% } %>
    <a href="<%= post.url %>/comments/create">Create Comment</a>
    <p>Text: <%= post.text %></p>
    <p>Date: <%= post.date %></p>
    <p>User: <%= post.user %></p>
    <p class="likes">Likes: <%= post.likes %></p>
    <button class="likeButton" data-url="<%= post.url %>/like">
        <% if (!post.likeUsers.includes(user)) { %>
            Like Post
        <% } else { %>
            Dislike Post
        <% } %>
    </button>
    <% post.comments.forEach(function(comment) { %>
        <p><%= comment.text %></p>
        <p><%= comment.date %></p>
        <p><%= comment.user %></p>
        <% if (comment.user === user) { %>
            <form action="<%= post.url %>/comments/<%= comment._id %>/update" method="POST">
                <label for="text">Text</label>
                <input name="text" placeholder="Text" type="text"/>
                <button>Update Comment</button>
            </form>
            <a href="<%= post.url %>/comments/<%= comment._id %>/delete">Delete Comment</a>
        <% } %>
    <% }); %>
</body>
</html>